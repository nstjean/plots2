<% unique_id = rand(1000) %>

  <style>
  	#map<%= unique_id %> { width:100%; height:500px; margin: 0; position: relative;}
  </style>

<div>
   <div class="leaflet-map" id="map<%= unique_id %>"></div>
 </div>
 
  <p><i><small>
    <% if !@map_lat.nil? && !@map_lon.nil? %>
      Current view based on your shared location. Click <a href='/profile'>here</a> to adjust.
    <% else %>
      Share your own location on <a href='/profile'>your profile</a>.
      Learn about <a href='https://publiclab.org/wiki/location-privacy'>privacy</a>
    <% end %>
  </small></i></p>


  <script>

    const bounds<%= unique_id %> = new L.LatLngBounds(
      new L.LatLng(84.67351257, -172.96875),
      new L.LatLng(-54.36775852, 178.59375)
    );

    <% zoom = zoom ||= (lat.to_s.length.to_i + 6) %>

    var map<%= unique_id %> = L.map("map<%= unique_id %>", {
      maxBounds: bounds<%= unique_id %>,
      maxBoundsViscosity: 0.75
    }).setView([<%= lat %>,<%= lon %>], <%= zoom || (lat.to_s.length.to_i + 6) %>);

    map<%= unique_id %>.options.minZoom = 2 ;

    var markers_hash<%= unique_id %> = new Map() ;

    var setHash = 1;
    <% if defined? url_hash != nil and url_hash == 0 %>
      setHash = 0;
    <% end %>

    var options<%= unique_id %> = {
      layers: ["PLpeople"]
    }
    setupLEL(map<%= unique_id %>, markers_hash<%= unique_id %>, options<%= unique_id %>);
    

  </script>
